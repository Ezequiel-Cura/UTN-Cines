<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container my-5">
        <h1 class="mb-4">Confirm Your Purchase</h1>
        <div id="cartItems"></div>
        <button class="btn btn-primary mt-4 me-2" onclick="pay()">Pay</button>
        <button class="btn btn-secondary mt-4" id="downloadPdf">Download PDF</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <script>
        // Retrieve cart data from localStorage
        const cart = JSON.parse(localStorage.getItem("cart")) || [];

        // Display cart items
        const cartItemsContainer = document.getElementById("cartItems");

        if (cart.length === 0) {
            cartItemsContainer.innerHTML = "<p>Your cart is empty.</p>";
        } else {
            cart.forEach(movie => {
                const item = document.createElement("div");
                item.className = "d-flex justify-content-between border-bottom py-2";
                item.innerHTML = `
                    <span>${movie.title} (x${movie.quantity})</span>
                    <span>$${(movie.quantity * 10).toFixed(2)}</span> <!-- Replace 10 with movie price -->
                `;
                cartItemsContainer.appendChild(item);
            });

            // Display total price
            const total = cart.reduce((sum, movie) => sum + movie.quantity * 10, 0); // Replace 10 with movie price
            const totalDiv = document.createElement("div");
            totalDiv.className = "d-flex justify-content-between border-top pt-2";
            totalDiv.innerHTML = `
                <strong>Total:</strong>
                <strong>$${total.toFixed(2)}</strong>
            `;
            cartItemsContainer.appendChild(totalDiv);
        }

        function pay() {
            // Clear the cart after payment
            localStorage.removeItem("cart");
            alert("Thank you for your purchase!");
            window.location.href = "../index.html"; // Redirect back to the homepage
        }

        // Function to generate PDF
        document.getElementById("downloadPdf").addEventListener("click", () => {
            const element = document.querySelector(".container");
            const options = {
                margin: 1,
                filename: 'checkout.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            html2pdf().set(options).from(element).save();
        });
    </script>
</body>
</html>
